<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 50px; }
    #ad1, #ad2 { margin: 20px 0; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <h2>⏳ Redirecting, please wait...</h2>
  <p id="message">Step 1: Wait 10 seconds</p>
  <p id="count">10</p>

  <!-- CUSTOM AD PLACEHOLDER STEP 1 -->
  <div id="ad1">
    <h3>Ad Slot 1</h3>
    <img src="https://ibb.co/0pWGxbyf" alt="Ad Banner 1">
  </div>

  <!-- CUSTOM AD PLACEHOLDER STEP 2 -->
  <div id="ad2" class="hidden">
    <h3>Ad Slot 2</h3>
    <img src="https://via.placeholder.com/300x100?text=Your+Ad+2" alt="Ad Banner 2">
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDBH7Jpu4_MBl7MKJ9lz9V5I4p0fcsddPc",
      authDomain: "mk-link-shortener.firebaseapp.com",
      projectId: "mk-link-shortener",
      storageBucket: "mk-link-shortener.firebasestorage.app",
      messagingSenderId: "168409013932",
      appId: "1:168409013932:web:28e0095f318dc7ad5d4909"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get short code from URL
    const code = window.location.pathname.split("/").pop();
    if (!code) {
      document.body.innerHTML = "❌ Invalid link";
    } else {
      const ref = doc(db, "links", code);
      getDoc(ref).then((snap) => {
        if (snap.exists()) {
          const finalURL = snap.data().url;

          // Step 1 countdown
          let step1 = 10;
          const countEl = document.getElementById("count");
          const messageEl = document.getElementById("message");
          const ad1El = document.getElementById("ad1");
          const ad2El = document.getElementById("ad2");

          const step1Timer = setInterval(() => {
            step1--;
            countEl.innerText = step1;
            if (step1 === 0) {
              clearInterval(step1Timer);
              // Step 2
              messageEl.innerText = "Step 2: Wait 10 seconds";
              countEl.innerText = "10";
              ad1El.classList.add("hidden");
              ad2El.classList.remove("hidden");

              let step2 = 10;
              const step2Timer = setInterval(() => {
                step2--;
                countEl.innerText = step2;
                if (step2 === 0) {
                  clearInterval(step2Timer);
                  // Final redirect
                  window.location.href = finalURL;
                }
              }, 1000);

            }
          }, 1000);

        } else {
          document.body.innerHTML = "❌ Link not found";
        }
      });
    }
  </script>

</body>
</html>
