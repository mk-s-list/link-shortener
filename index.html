<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MK Link Shortener</title>
</head>
<body>
  <h3>Redirectingâ€¦</h3>

  <script type="module">
    // Firebase core
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    // YOUR Firebase config (unchanged)
    const firebaseConfig = {
      apiKey: "AIzaSyDBH7Jpu4_MBl7MKJ9lz9V5I4p0fcsddPc",
      authDomain: "mk-link-shortener.firebaseapp.com",
      projectId: "mk-link-shortener",
      storageBucket: "mk-link-shortener.firebasestorage.app",
      messagingSenderId: "168409013932",
      appId: "1:168409013932:web:28e0095f318dc7ad5d4909"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get short code from URL
    const shortCode = window.location.pathname.replace("/", "");

    if (!shortCode) {
      document.body.innerHTML = "Invalid short link";
    } else {
      const q = query(
        collection(db, "links"),
        where("short", "==", shortCode)
      );

      getDocs(q)
        .then((snap) => {
          if (!snap.empty) {
            const original = snap.docs[0].data().original;
            window.location.href = original;
          } else {
            document.body.innerHTML = "404 - Link not found";
          }
        })
        .catch((err) => {
          console.error(err);
          document.body.innerHTML = "Error loading link";
        });
    }
  </script>
</body>
</html>
